name: ðŸ­ ç³»ç»Ÿå¥åº·è¶‹åŠ¿çœ‹æ¿ï¼ˆL4.5 Observationï¼‰

on:
  workflow_dispatch:

jobs:
  observe:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“¥ Checkout repo
        uses: actions/checkout@v4

      - name: ðŸ§® ç”Ÿæˆè¿è¡Œè¶‹åŠ¿æ‘˜è¦
        shell: bash
        run: |
          echo "### ðŸ­ å·¥åŽ‚è¿è¡Œè¶‹åŠ¿ï¼ˆæœ€è¿‘ 7 æ¬¡ï¼‰" >> $GITHUB_STEP_SUMMARY

          STATS=$(tail -n 7 run_history.jsonl | jq -s '
            {
              fallback_rate: (map(select(.fallback_used == true)) | length),
              avg_retries: (map(.retry_count) | add / length),
              unique_fingerprints: (map(.semantic_fingerprint) | unique | length)
            }')

          FB_COUNT=$(echo $STATS | jq '.fallback_rate')
          UNIQUE_FP=$(echo $STATS | jq '.unique_fingerprints')

          echo "| è§‚å¯Ÿç»´åº¦ | å½“å‰å€¼ | è¯„ä¼° |" >> $GITHUB_STEP_SUMMARY
          echo "| --- | --- | --- |" >> $GITHUB_STEP_SUMMARY
          echo "| é™çº§é¢‘æ¬¡ï¼ˆ7æ—¥ï¼‰ | $FB_COUNT | $( [ $FB_COUNT -ge 3 ] && echo 'âš ï¸ æ³¨æ„' || echo 'âœ… æ­£å¸¸' ) |" >> $GITHUB_STEP_SUMMARY
          echo "| è¯­ä¹‰ç¨³å®šæ€§ï¼ˆ7æ—¥ï¼‰ | $UNIQUE_FP/3 | $( [ $UNIQUE_FP -lt 2 ] && echo 'âš ï¸ å¯èƒ½å­˜åœ¨å¾ªçŽ¯' || echo 'âœ… æ­£å¸¸' ) |" >> $GITHUB_STEP_SUMMARY

          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ’¡ **æç¤º**ï¼šå½“å‰å¤„äºŽè§‚å¯ŸæœŸï¼Œç³»ç»Ÿä¸ä¼šè‡ªåŠ¨ç†”æ–­ã€‚è‹¥é™çº§é¢‘æ¬¡æŒç»­èµ°é«˜ï¼Œè¯·æ‰‹åŠ¨æ£€æŸ¥ã€‚" >> $GITHUB_STEP_SUMMARY
