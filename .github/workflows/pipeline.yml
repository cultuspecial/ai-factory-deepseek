name: ðŸ§± ç³»ç»Ÿå¥åº·è¶‹åŠ¿çœ‹æ¿ï¼ˆL4.5 Observationï¼‰

on:
  workflow_dispatch:

jobs:
  observe:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“¦ Checkout repo
        uses: actions/checkout@v4

      - name: ðŸ“Š ç”Ÿæˆè¿è¡Œè¶‹åŠ¿æ‘˜è¦ï¼ˆå®‰å…¨æ¨¡å¼ï¼‰
        if: always()
        run: |
          echo "### ðŸ­ å·¥åŽ‚è¿è¡Œè¶‹åŠ¿ï¼ˆæœ€è¿‘ 7 æ¬¡ï¼‰" >> $GITHUB_STEP_SUMMARY

          if [ ! -s run_history.jsonl ]; then
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "âš ï¸ å½“å‰æš‚æ— åŽ†å²è¿è¡Œæ•°æ®ï¼ˆé¦–æ¬¡è¿è¡Œå±žæ­£å¸¸æƒ…å†µï¼‰" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "ç³»ç»Ÿå°†åœ¨ä¸‹ä¸€æ¬¡è¿è¡ŒåŽå¼€å§‹ç”Ÿæˆè¶‹åŠ¿ç»Ÿè®¡ã€‚" >> $GITHUB_STEP_SUMMARY
            exit 0
          fi

          COUNT=$(tail -n 7 run_history.jsonl | wc -l)
          FALLBACK_COUNT=$(tail -n 7 run_history.jsonl | jq -s '[.[] | select(.fallback_used == true)] | length')
          UNIQUE_FP=$(tail -n 7 run_history.jsonl | jq -s '[.[] | .semantic_fingerprint] | unique | length')

          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| æŒ‡æ ‡ | æ•°å€¼ |" >> $GITHUB_STEP_SUMMARY
          echo "|---|---|" >> $GITHUB_STEP_SUMMARY
          echo "| è¿è¡Œæ¬¡æ•° | ${COUNT} |" >> $GITHUB_STEP_SUMMARY
          echo "| é™çº§æ¬¡æ•° | ${FALLBACK_COUNT} |" >> $GITHUB_STEP_SUMMARY
          echo "| è¯­ä¹‰æŒ‡çº¹æ•° | ${UNIQUE_FP} |" >> $GITHUB_STEP_SUMMARY
